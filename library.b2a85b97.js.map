{"mappings":"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","sources":["src/js/library.js"],"sourcesContent":["import createGalleryMarkup from './create-gallery';\n// import { getGenreNames } from './create-gallery';\nimport {\n  storageKeys,\n  buttonStates,\n  storageHasMovie,\n  addWatchedBtn,\n  addQueueBtn,\n} from './storage';\n// import { setMarkup } from './create-gallery';\nimport getGenreNames from './create-gallery';\n\n// import Pagination from 'tui-pagination';\n// import { paginationOptions } from './projectOptions';\n\nimport './modal-login';\n\nconsole.log('START');\n\nconst refs = {\n  btnWatched: document.querySelector('.watched'),\n  btnQueue: document.querySelector('.queue'),\n  libraryGallery: document.querySelector('.gallery'),\n  loader: document.querySelector('.loader'),\n  noItemsImg: document.querySelector('.library__no-items'),\n};\nrefs.loader.classList.add('is-hidden');\n\nexport let currentState = 'empty';\nexport let watchedMovies = '';\nexport let queueMovies = '';\n\n// ============================\n// Генерация галереи при первом старте\nif (localStorage.getItem('WATCHED')) {\n  watchedMovies = JSON.parse(localStorage.getItem('WATCHED'));\n  console.log('watchedMovies :>> ', watchedMovies.length);\n\n  if (!!watchedMovies.length) {\n    currentState = 'watched';\n    refs.loader.classList.add('is-hidden');\n    createGalleryMarkup(watchedMovies);\n    refs.btnQueue.classList.remove('library-header__button--active');\n    refs.btnWatched.classList.add('library-header__button--active');\n  }\n}\nif (localStorage.getItem('QUEUE')) {\n  queueMovies = JSON.parse(localStorage.getItem('QUEUE'));\n  if (!!queueMovies.length) {\n    // refs.btnWatched.disabled = true;\n    currentState = 'queue';\n    refs.loader.classList.add('is-hidden');\n    createGalleryMarkup(queueMovies);\n    refs.btnWatched.classList.remove('library-header__button--active');\n    refs.btnQueue.classList.add('library-header__button--active');\n  }\n}\nif (currentState === 'empty') {\n  refs.btnQueue.disabled = true;\n  refs.btnWatched.disabled = true;\n  refs.noItemsImg.style.display = 'block';\n}\n// ================================\nfunction refreshLibrary() {\n  switch (currentState) {\n    case 'watched':\n      watchedMovies = JSON.parse(localStorage.getItem('WATCHED'));\n      createGalleryMarkup(watchedMovies);\n      break;\n\n    case 'queue':\n      queueMovies = JSON.parse(localStorage.getItem('QUEUE'));\n      createGalleryMarkup(queueMovies);\n      break;\n  }\n}\n// if (refs.btnQueue.disabled && refs.btnWatched.disabled) {\n//   refs.noItemsImg.style.display = 'block';\n// }\n\n// =====================================================================================\n\nrefs.btnWatched.addEventListener('click', onWatchedButtonClick);\nrefs.btnQueue.addEventListener('click', onQueueButtonClick);\n\n// =====================================\n\nfunction onWatchedButtonClick(event) {\n  event.preventDefault();\n  console.log(event);\n  if (event.target.classList.contains('watched')) {\n    refs.btnQueue.classList.remove('library-header__button--active');\n    refs.btnWatched.classList.add('library-header__button--active');\n  }\n  currentState = 'watched';\n\n  //--------------------------------------\n  // Pagination Lisovoy Alexe\n  //--------------------------------------\n  console.log('watchedMovies :>> ', watchedMovies);\n  const cardsPerPade = 10;\n  const totalCards = watchedMovies.length;\n  const totalPages = Math.ceil(totalCards / cardsPerPade);\n  console.log('totalPages :>> ', totalPages);\n\n  // const dataByPages = watchedMovies.reduce((acc, card, idx, arr) => {\n  //   // console.log('acc :>> ', acc);\n  //   // console.log('page :>> ', page);\n  //   const pageArr = arr.filter(card, idx => idx < cardsPerPade);\n\n  //   // return acc;\n  // }, []);\n\n  // console.log('dataByPages :>> ', dataByPages);\n\n  // if (totalPages > 1) {\n  //   // console.log(`Рендерим Пагинацию на ${totalPages} страниц`);\n\n  //   const paginaton = new Pagination(refs.tuiContainer, {\n  //     ...paginationOptions,\n  //     totalItems: totalPages,\n  //   });\n  //   paginaton.on('afterMove', async ({ page }) => {\n  //     newApiServiсe.currentPage = page;\n  //     const response = await newApiServiсe.fetchTrendingFilms();\n  //     localStorage.setItem('movieData', JSON.stringify(response.results));\n  //     const imagesArray = await response.results;\n\n  //     createGalleryMarkup(watchedMovies);\n  //   });\n  // }\n\n  createGalleryMarkup(watchedMovies);\n\n  //\n  //--------------------------------------\n\n  refs.loader.classList.add('is-hidden');\n}\n\nfunction onQueueButtonClick(event) {\n  // console.log('QQQQQ');\n  event.preventDefault();\n  if (event.target.classList.contains('queue')) {\n    refs.btnWatched.classList.remove('library-header__button--active');\n    refs.btnQueue.classList.add('library-header__button--active');\n  }\n  currentState = 'queue';\n  createGalleryMarkup(queueMovies);\n  refs.loader.classList.add('is-hidden');\n}\n\nfunction closeModal() {\n  document.querySelector('.backdrop').style.display = 'none';\n  document.querySelector('body').style.overflowY = 'visible';\n  console.log('currentState при закрытии модалки->', currentState);\n  refreshLibrary();\n}\n\ndocument.querySelector('.modal__close').addEventListener('click', closeModal);\n\nCURRENTSTATE = currentState.toUpperCase();\nconsole.log('currentState==', CURRENTSTATE);\n// ========================================\n// открытие модалки\ndocument.querySelector('.gallery').addEventListener('click', function (e) {\n  let targetItem = e.target;\n  if (targetItem.closest('.card')) {\n    const movieId = targetItem.closest('.card').getAttribute('movie-id');\n    const data = JSON.parse(localStorage.getItem(CURRENTSTATE));\n    const movie = data.find(item => {\n      if (Number(movieId) === item.id) {\n        return true;\n      }\n    });\n    currentMovie = movie;\n\n    document\n      .querySelector('.content-card__img>img')\n      .setAttribute(\n        'src',\n        'https://image.tmdb.org/t/p/w500' + movie.poster_path\n      );\n    document.querySelector('.content-card__title').innerText = movie.title;\n    document.querySelector('.content-card__about-text').innerText =\n      movie.overview;\n\n    document.querySelector('.modal__movie-bord').innerText =\n      movie.vote_average.toFixed(1);\n    document.querySelector('.modal__movie-number').innerText = movie.vote_count;\n    document.querySelector('.modal__movie-popularity').innerText =\n      movie.popularity.toFixed(1);\n    document.querySelector('.modal__movie-original').innerText =\n      movie.original_title;\n    document.querySelector('.modal__movie-genres').innerText = getGenreNames(\n      movie.genre_ids\n    );\n\n    openModal();\n  }\n});\n\n// открытие модалки\n// =====================================\nfunction openModal() {\n  document.querySelector('.backdrop').style.display = 'block';\n  document.querySelector('body').style.overflowY = 'hidden';\n\n  //Встановлення тексту кнопки \"ADD TO WATCHED\"\n  if (storageHasMovie(storageKeys.watched, currentMovie.id)) {\n    addWatchedBtn.textContent = buttonStates.on + ' ' + storageKeys.watched;\n  } else {\n    addWatchedBtn.textContent = buttonStates.off + ' ' + storageKeys.watched;\n  }\n\n  //Встановлення тексту кнопки \"ADD TO QUEUE\"\n  if (storageHasMovie(storageKeys.queue, currentMovie.id)) {\n    addQueueBtn.textContent = buttonStates.on + ' ' + storageKeys.queue;\n  } else {\n    addQueueBtn.textContent = buttonStates.off + ' ' + storageKeys.queue;\n  }\n}\n// ==============================\n//закриття модалки по кліку поза модалки\nwindow.addEventListener('click', function (event) {\n  if (event.target === document.querySelector('.backdrop')) {\n    closeModal();\n  }\n});\n\n//закрытие модалки по esc\nwindow.addEventListener('keydown', e => {\n  if (e.keyCode === 27) {\n    closeModal();\n  }\n});\n"],"names":["$9Zl8s","parcelRequire","console","log","$1cafa503bc57b7a0$var$refs","btnWatched","document","querySelector","btnQueue","libraryGallery","loader","noItemsImg","classList","add","$1cafa503bc57b7a0$export$cd7001275a966deb","$1cafa503bc57b7a0$export$2892008fa6042796","$1cafa503bc57b7a0$export$7d802160ffeb9197","$1cafa503bc57b7a0$var$closeModal","style","display","overflowY","JSON","parse","localStorage","getItem","default","$1cafa503bc57b7a0$var$refreshLibrary","length","remove","disabled","addEventListener","event","preventDefault","target","contains","totalCards","totalPages","Math","ceil","CURRENTSTATE","toUpperCase","e","targetItem","closest","movieId","getAttribute","movie","find","item","Number","id","currentMovie","setAttribute","poster_path","innerText","title","overview","vote_average","toFixed","vote_count","popularity","original_title","genre_ids","$5uEKZ","storageHasMovie","storageKeys","watched","addWatchedBtn","textContent","buttonStates","on","off","queue","addQueueBtn","$1cafa503bc57b7a0$var$openModal","window","keyCode"],"version":3,"file":"library.b2a85b97.js.map"}